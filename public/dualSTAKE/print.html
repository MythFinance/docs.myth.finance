<!DOCTYPE HTML>
<html lang="en" class="ayu" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>dualSTAKE Documentation: Algorand Liquid Staking with ASA rewards</title>
        <meta name="robots" content="noindex">


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

        <!-- MathJax -->
        <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "ayu" : "ayu";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('ayu')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><li class="part-title">dualSTAKE Documentation</li><li class="chapter-item expanded "><a href="overview.html"><strong aria-hidden="true">1.</strong> Overview</a></li><li class="chapter-item expanded affix "><li class="part-title">For Users</li><li class="chapter-item expanded "><a href="how-it-works.html"><strong aria-hidden="true">2.</strong> How it Works</a></li><li class="chapter-item expanded "><a href="mint.html"><strong aria-hidden="true">3.</strong> Minting</a></li><li class="chapter-item expanded "><a href="rewards.html"><strong aria-hidden="true">4.</strong> Staking Reward Swapping</a></li><li class="chapter-item expanded "><a href="redeem.html"><strong aria-hidden="true">5.</strong> Redeeming</a></li><li class="chapter-item expanded affix "><li class="part-title">Technical</li><li class="chapter-item expanded "><a href="rate.html"><strong aria-hidden="true">6.</strong> Exchange Rate</a></li><li class="chapter-item expanded "><a href="fees.html"><strong aria-hidden="true">7.</strong> Fee Structure</a></li><li class="chapter-item expanded affix "><li class="part-title">For Creators</li><li class="chapter-item expanded "><a href="create.html"><strong aria-hidden="true">8.</strong> Creating dualSTAKE contracts</a></li><li class="chapter-item expanded "><a href="farming.html"><strong aria-hidden="true">9.</strong> Farming</a></li><li class="chapter-item expanded affix "><li class="part-title">For Node Runners</li><li class="chapter-item expanded "><a href="noderunners.html"><strong aria-hidden="true">10.</strong> Running a dualSTAKE node</a></li><li class="chapter-item expanded affix "><li class="part-title">For Developers</li><li class="chapter-item expanded "><a href="ts-sdk.html"><strong aria-hidden="true">11.</strong> Typescript SDK</a></li><li class="chapter-item expanded affix "><li class="part-title">Contract Info</li><li class="chapter-item expanded "><a href="roles.html"><strong aria-hidden="true">12.</strong> Roles</a></li><li class="chapter-item expanded "><a href="immutability.html"><strong aria-hidden="true">13.</strong> Immutability</a></li><li class="chapter-item expanded "><a href="txn-fees.html"><strong aria-hidden="true">14.</strong> Transaction fees</a></li><li class="chapter-item expanded "><a href="storage.html"><strong aria-hidden="true">15.</strong> Contract Storage</a></li><li class="chapter-item expanded "><a href="abi.html"><strong aria-hidden="true">16.</strong> Contract ABI</a></li><li class="chapter-item expanded affix "><li class="part-title">Audit</li><li class="chapter-item expanded "><a href="audit.html"><strong aria-hidden="true">17.</strong> Audit</a></li><li class="chapter-item expanded affix "><li class="part-title">Misc</li><li class="chapter-item expanded "><a href="links.html"><strong aria-hidden="true">18.</strong> Links</a></li><li class="chapter-item expanded "><a href="contact.html"><strong aria-hidden="true">19.</strong> Contact</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">dualSTAKE Documentation: Algorand Liquid Staking with ASA rewards</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="dualstake-overview"><a class="header" href="#dualstake-overview">dualSTAKE Overview</a></h1>
<p>dualSTAKE is a <strong>family of liquid staking tokens</strong> on Algorand that <strong>convert staking rewards</strong> into ASAs.</p>
<p>Each dualSTAKE token pairs <code>ALGO</code> and an ASA into a liquid staking token:</p>
<ul>
<li><code>coopALGO</code> = <code>ALGO</code> + <code>COOP</code></li>
<li><code>oraALGO</code> = <code>ALGO</code> + <code>ORA</code></li>
<li><code>cosgALGO</code> = <code>ALGO</code> + <code>COSG</code></li>
</ul>
<p>In a nutshell:</p>
<ol>
<li>dualSTAKE smart contracts <strong>participate in consensus</strong>.</li>
<li>Staking rewards are <strong>swapped</strong> into the paired ASA.</li>
<li>Through these swaps, dualSTAKE tokens <strong>appreciate in the ASA</strong>.</li>
</ol>
<p>Benefits for users:</p>
<ul>
<li>Stake <code>ALGO</code>, get rewarded in your ASA of choice
<ul>
<li>Steady stream of DCA-like buys</li>
</ul>
</li>
</ul>
<p>Benefits for ASA creators:</p>
<ul>
<li>Leverage community <code>ALGO</code> into a steady stream of buying pressure for your ASA</li>
<li>Provide utility for the ASA via the implicit dualSTAKE token soft-lock</li>
</ul>
<p>Read more about <a href="/how-it-works.html">how it works</a> or navigate to a specific section using the menu.</p>
<hr />
<p>Supported ASA Tokens at launch (full list TBD): MONKO, COOP, ORA, maybe your token</p>
<p>Development status: In Review</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="how-it-works"><a class="header" href="#how-it-works">How it Works</a></h1>
<p>dualSTAKE tokens are named after <code>ALGO</code> and the paired ASA.</p>
<p><em>For the purposes of this section, we will use <code>ORA</code> as the paired dualSTAKE asset.</em></p>
<p>The <code>ORA</code> dualSTAKE token is called <code>oraALGO</code>.</p>
<ul>
<li>Each <code>oraALGO</code> is backed by <code>ALGO</code> at a rate of 1:1</li>
<li>Each <code>oraALGO</code> is backed by an increasing amount of <code>ORA</code></li>
</ul>
<p>Each dualSTAKE token is managed by a smart contract. Different tokens are managed by independent contracts, without co-mingling.</p>
<p>A typical user journey with a dualSTAKE token like <code>oraALGO</code> would consist of:</p>
<ol>
<li><a href="./mint.html">minting</a> dualSTAKE (e.g. <code>oraALGO</code>) by depositing <code>ALGO</code> + <code>ORA</code></li>
<li><em>(later on)</em> <a href="./redeem.html">redeeming</a> their <code>oraALGO</code> dualSTAKE tokens for <code>ALGO</code> + more <code>ORA</code>.</li>
</ol>
<p>Between points 1 and 2, the dualSTAKE contract would receive staking rewards from block production, which are immediately <a href="./rewards.html">swapped</a> into the paired ASA, thus <code>oraALGO</code> appreciates against <code>ORA</code>. The amount of staked <code>ALGO</code> remains constant.</p>
<p>Read more about <a href="./mint.html">minting</a> or navigate to a specific section using the menu.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="minting"><a class="header" href="#minting">Minting</a></h1>
<p>Users can mint dualSTAKE tokens by depositing <code>ALGO</code> and the paired ASA into the smart contract.</p>
<p>Using <code>oraALGO</code> as an example, a user would mint by depositing:</p>
<ul>
<li><code>ALGO</code> at a fixed 1:1 rate</li>
<li><code>ORA</code> at the current <a href="./rate.html">exchange rate</a>.</li>
</ul>
<p>In exchange, they receive an equal amount of <code>oraALGO</code> tokens to the <code>ALGO</code> they deposited.</p>
<p><em>E.g. If <code>oraALGO</code> is at 10:1 with <code>ORA</code>, the user would deposit 10 <code>ALGO</code> + 1 <code>ORA</code> to receive 10 <code>oraALGO</code> tokens.</em></p>
<p><em>If <code>oraALGO</code> is at 2:1 with <code>ORA</code>, the user would deposit 10 <code>ALGO</code> + 5 <code>ORA</code> to receive 10 <code>oraALGO</code> tokens.</em></p>
<p>Minting does not incur any platform fees.</p>
<p>Read more about <a href="./redeem.html">redeeming</a> or navigate to a specific section using the menu.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="staking-rewards"><a class="header" href="#staking-rewards">Staking Rewards</a></h1>
<p>A dualSTAKE smart contract delegates its escrow account's voting power to a node runner, in order for them to participate in consensus on its behalf.</p>
<p>As blocks are proposed by the node:</p>
<ul>
<li>The Algorand protocol distributes <code>ALGO</code> rewards into the smart contract escrow account</li>
<li>The <code>ALGO</code> rewards are swapped into the ASA (e.g. <code>ORA</code>) through a pre-configured AMM pool (e.g. Tinyman v2 <code>ALGO/ORA</code>)</li>
<li>The dualSTAKE token (e.g. <code>oraALGO</code>) appreciates against the paired ASA (e.g. <code>ORA</code>)</li>
</ul>
<p><strong>These swaps create buying pressure on the paired token, and serve as a steady cost averaging buy strategy for users.</strong></p>
<p>Platform and node runner fees are taken from the staking rewards, pre-swap.</p>
<p>Swapping is triggered in one of two ways:</p>
<ul>
<li>Our backend systems will call the contract to perform the <code>ALGO</code>-<code>ASA</code> swap whenever a block is produced</li>
<li>Automatically before minting or redeeming dualSTAKE tokens</li>
</ul>
<p>This way, even if our backend systems lag behind or are offline, you can be sure that the dualSTAKE exchange rate is correct.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="redeeming"><a class="header" href="#redeeming">Redeeming</a></h1>
<p>Users can redeem their dualSTAKE tokens at any time. Redeeming breaks dualSTAKE up into their component parts and returns them to the user.</p>
<p>Using <code>oraALGO</code> as an example:</p>
<p>Users can redeem their <code>oraALGO</code> tokens via the smart contract and receive the backing <code>ALGO</code> (at 1:1) and <code>ORA</code> (at <a href="./rate.html">current rate</a>).</p>
<p><em>E.g. Alice minted 10 <code>oraALGO</code> by depositing 10 <code>ALGO</code> and 1 <code>ORA</code>. Some time later, <code>oraALGO</code> has appreciated against <code>ORA</code>, so she redeems her 10 <code>oraALGO</code> tokens for 10 <code>ALGO</code> and 3.14 <code>ORA</code>.</em></p>
<p>Minting and redeeming do not incur platform fees, so users should always receive at least as much <code>ALGO</code> and <code>ORA</code> as they deposited.</p>
<p>Assuming staking rewards have accumulated between minting and redeeming, the <code>ORA</code> amount withdrawn during redemption will be larger than the deposited amount during mint.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="rate"><a class="header" href="#rate">Rate</a></h1>
<p>dualSTAKE tokens are backed by <code>ALGO</code> and their paired asset, with a different exchange rate for each.</p>
<p>Minting dualSTAKE tokens will require the equivalent amounts of both tokens, and similarly redeeming will yield the equivalent amounts of both tokens.</p>
<p>The formula to determine the exchange rate of the dualSTAKE token to the paired assets is:</p>
<p>\[1\ dsALGO=1\ ALGO+\frac{Paired\ ASA\ Balance}{Staked\ ALGO}ASA\]</p>
<p>Where:</p>
<ul>
<li><code>dsALGO</code> refers to a specific dualSTAKE token, e.g. <code>oraALGO</code></li>
<li><code>Paired ASA Balance</code> refers to the amount of the paired ASA held by the smart contract, e.g. 300 <code>ORA</code></li>
<li><code>Staked ALGO</code> refers to the <code>ALGO</code> deposited by users
<ul>
<li>Not including accumulated platform or node runner fees</li>
</ul>
</li>
</ul>
<h2 id="example"><a class="header" href="#example">Example</a></h2>
<p>Assuming the <code>oraALGO</code> dualSTAKE contract has:</p>
<ul>
<li>30,000 <code>ALGO</code> staked</li>
<li>10,000 <code>ORA</code> balance</li>
</ul>
<p>Then:</p>
<p>\[1\ oraALGO=1\ ALGO+\frac{1}{3}ORA\]</p>
<h3 id="initial-asa-exchange-rate"><a class="header" href="#initial-asa-exchange-rate">Initial ASA exchange rate</a></h3>
<p>Usually, the initial dualSTAKE:ASA exchange rate will be zero, but in some cases a community intending to provide a generous farm may choose to bootstrap a dualSTAKE token with a non-zero exchange rate for their ASA.</p>
<p>This would impose a requirement to deposit some of the asset when minting the dualSTAKE token "at time zero", before rewards have started accumulating.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="fee-structure"><a class="header" href="#fee-structure">Fee Structure</a></h1>
<h2 id="mint--redeem-fees"><a class="header" href="#mint--redeem-fees">Mint &amp; Redeem fees</a></h2>
<p>Minting &amp; redeeming do not incur any platform fees. The only fees you will be charged during these operations are network transaction fees.</p>
<p>Fees are instead taken from rewards, before they are swapped to the ASA.</p>
<h2 id="platform-fees"><a class="header" href="#platform-fees">Platform fees</a></h2>
<p>The platform is allocated some fees on each rewards distribution.</p>
<p>The percentage is configurable throughout the lifetime of the contract, and can be seen under the global storage key <code>pltbps</code>. This value is basis points, so you can divide by 100 to get the percent fee. The initial value <code>200</code> corresponds to <code>2.0%</code>.</p>
<p>There are mechanisms in place to protects dualSTAKE users from the operator changing platform fees abruptly, see <a href="/immutability.html#platform-and-node-operator-fee-rates">Immutability - Fee Rate</a>.</p>
<h2 id="node-runner-fees"><a class="header" href="#node-runner-fees">Node runner fees</a></h2>
<p>The node operator is allocated some fees on each rewards distribution. As above, this is expressed in basis points under the <code>nodbps</code> global storage field, and the same <a href="/immutability.html#fee-rate">update mechanism</a> applies.</p>
<p>The initial node runner fee will be <code>300</code> bps, or <code>3%</code>.</p>
<h2 id="example-fee-allocation-from-reward-disbursement"><a class="header" href="#example-fee-allocation-from-reward-disbursement">Example fee allocation from reward disbursement</a></h2>
<p>Assuming these hypothetical fees:</p>
<ul>
<li>Platform fee rate: 2.0%</li>
<li>Node operator fee rate: 3.0%</li>
</ul>
<p>Then a staking reward disbursement of 10.5 <code>ALGO</code> would be allocated as such:</p>
<ul>
<li>Staking rewards deposited: 10.5 <code>ALGO</code></li>
<li>Platform fee: 0.21 <code>ALGO</code></li>
<li>Node operator fee: 0.315 <code>ALGO</code></li>
<li>Net amount to be swapped into ASA: 9.975 <code>ALGO</code></li>
</ul>
<h2 id="withdraw-model"><a class="header" href="#withdraw-model">Withdraw model</a></h2>
<p>Platform and node operator fees are not paid immediately. Instead they remain in the contract escrow account until they are withdrawn by the respective operator.</p>
<p>This serves multiple purposes:</p>
<ul>
<li>fewer required transaction fees</li>
<li>contributing to the voting power of the dualSTAKE escrow address in consensus</li>
<li>fewer taxable events for the platform and node runners.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="creating-dualstake-contracts"><a class="header" href="#creating-dualstake-contracts">Creating dualSTAKE contracts</a></h1>
<p>Currently, creating dualSTAKE contracts is a manual process.</p>
<p><strong>Please <a href="./contact.html">reach out</a> to the team if you are interested in creating a dualSTAKE token for your ASA.</strong></p>
<p>A number of preconditions must be met to ensure that the protocol functions as expected:</p>
<ul>
<li>Sufficient decimal precision for assets
<ul>
<li>Assets with low decimal precision may not be suitable for this version of dualSTAKE.</li>
</ul>
</li>
<li>Liquidity pool must be chosen correctly
<ul>
<li>Currently, tinyman v2 liquidity pools are supported
<ul>
<li>Changing the LP requires a smart contract upgrade</li>
</ul>
</li>
<li>A shallow pool without deep liquidity may result in inefficient swaps resulting in loss of rewards to arbitrage</li>
</ul>
</li>
<li>Initial Exchange Rate
<ul>
<li>A non-zero initial exchange rate is supported, but should only be used in case of significant farming provision</li>
</ul>
</li>
<li>Asset information
<ul>
<li>Asset unit names are currently chosen manually.</li>
<li>The AVM restricts this field to 8 characters maximum length, requiring flexibility in naming dualSTAKE units for assets with longer names (e.g. <code>$MONKO</code>)</li>
</ul>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="farm-provision"><a class="header" href="#farm-provision">Farm provision</a></h1>
<p>Ecosystem projects and ASA creators are encouraged to create farms for their dualSTAKE tokens.</p>
<p>Farms are configured to pay out a specific supplement in ASA along with each staking reward disbursed by the Algorand protocol.</p>
<p>This extra farming incentive should further incentivize users to deposit their <code>ALGO</code> along with the paired ASA into the community's dualSTAKE token. More <code>ALGO</code> deposited means more blocks produced, means more frequent buying pressure on the token.</p>
<p>As rewards accumulate and are swapped, the exchange rate of the dualSTAKE token to the ASA increases globally for all holders, current and future.</p>
<p>Minting new dualSTAKE tokens will require more of the ASA as time moves on, which provides a soft-lock utility for tokens making use of this system.</p>
<h2 id="farming-benefits"><a class="header" href="#farming-benefits">Farming benefits</a></h2>
<ol>
<li>buying pressure, resulting from swapping rewards</li>
<li>utilizing part of their circulating supply into the dualSTAKE system as a soft-lock</li>
</ol>
<div style="break-before: page; page-break-before: always;"></div><h1 id="running-a-dualstake-node"><a class="header" href="#running-a-dualstake-node">Running a dualSTAKE node</a></h1>
<p>TBD</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="typescript-sdk"><a class="header" href="#typescript-sdk">Typescript SDK</a></h1>
<p>Developers can use the published <a href="">Typescript SDK</a> to interact with dualSTAKE contracts programmatically.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="roles"><a class="header" href="#roles">Roles</a></h1>
<p>The dualSTAKE smart contract has a number of privileged roles that can perform authorized actions:</p>
<h2 id="admin"><a class="header" href="#admin">Admin</a></h2>
<p>A multisig account controlled by the core team.</p>
<p>Can perform the following actions:</p>
<ul>
<li>Queue smart contract upgrade</li>
<li>Execute vested smart contract upgrade (shared with <code>fee admin</code> role)</li>
<li>Cancel smart contract upgrade (shared with the <code>fee admin</code> role)</li>
<li>Change <code>admin</code> role address</li>
<li>Change <code>fee admin</code> role address (shared with the <code>fee admin</code> role)</li>
</ul>
<h2 id="fee-admin"><a class="header" href="#fee-admin">Fee Admin</a></h2>
<p>A lower-security account controlled by the core team.</p>
<p>Can perform the following actions:</p>
<ul>
<li>Execute vested smart contract upgrade (shared with <code>admin</code> role)</li>
<li>Cancel smart contract upgrade (shared with the <code>admin</code> role)</li>
<li>Change <code>fee admin</code> role address (shared with the <code>admin</code> role)</li>
<li>Queue fee update</li>
<li>Cancel queued fee update</li>
<li>Withdraw platform fees</li>
<li>Withdraw node runner fees to node runner address (shared with <code>node runner</code> role)</li>
<li>Perform keyreg online transaction (shared with <code>node runner</code> role)</li>
<li>Perform keyreg offline transaction (shared with <code>node runner</code> role)</li>
<li>Change node runner address (shared with <code>node runner</code> role)
<ul>
<li>Condition: node runner fees must be withdrawn</li>
</ul>
</li>
<li>Dissolve protesting stake
<ul>
<li>In order to execute a protested upgrade</li>
</ul>
</li>
<li>Return protesting stake
<ul>
<li>After a protested upgrade is cancelled</li>
</ul>
</li>
</ul>
<h2 id="node-runner"><a class="header" href="#node-runner">Node runner</a></h2>
<p>Account controlled by node runner. Used to withdraw fees and manage key registrations.</p>
<ul>
<li>Change node runner address (shared with <code>fee admin</code> role)
<ul>
<li>Condition: node runner fees must be withdrawn</li>
</ul>
</li>
<li>Withdraw node runner fees (shared with <code>fee admin</code> role)</li>
<li>Perform keyreg online transaction (shared with <code>fee admin</code> role)</li>
<li>Perform keyreg offline transaction (shared with <code>fee admin</code> role)</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="immutability"><a class="header" href="#immutability">Immutability</a></h1>
<h2 id="smart-contract-code"><a class="header" href="#smart-contract-code">Smart contract code</a></h2>
<p>Smart contract code is upgradable with a 2 week time-lock.</p>
<p>The hashes of the proposed code upgrade will be published in advance for review by the community.</p>
<p>Users who do <em>not</em> want to upgrade the contract have the option of "protesting".</p>
<h3 id="protesting-upgrades"><a class="header" href="#protesting-upgrades">Protesting upgrades</a></h3>
<p>"Protesting" provides users with a way to indicate that a specific upgrade is a deal-breaker for them.</p>
<p>This is a programmatically enforced exit from the dualSTAKE token, conditional on the upgrade taking place.</p>
<p>Users wishing to protest a proposed upgrade can lock up their LST tokens on the contract.</p>
<p>For the platform operator to upgrade the code, they must first "dissolve" all protesting user tokens:</p>
<ul>
<li>redeem the tokens</li>
<li>send them their <code>ALGO</code>+ASA equivalent to the user that deposited them</li>
</ul>
<p><em>Note: when dissolving protesting stake, funds flow from the contract to the user directly, without intermediation by the platform operator.</em></p>
<p>An upgrade can not take place unless:</p>
<ul>
<li>2 weeks have elapsed since it was scheduled</li>
<li>All protesting stake has been removed and returned</li>
</ul>
<p>If enough stake is locked up as protesting, the platform operator may choose to cancel a planned upgrade, in which case the protesting stake will be sent back to users as-is, without redemption.</p>
<h2 id="fee-configuration"><a class="header" href="#fee-configuration">Fee Configuration</a></h2>
<p>Fee configuration changes to the contract will be time-delayed.</p>
<p>The "fee admin" role will be able to change the fee rates:</p>
<ul>
<li>with a time delay of 2 weeks before effect</li>
<li>with a max change of the fee value of +/-
<ul>
<li>As such, the fee admin would not be able to immediately change the fee rate to 100%, which would compromise dualSTAKE holders' rewards.</li>
</ul>
</li>
</ul>
<h3 id="platform-and-node-operator-fee-rates"><a class="header" href="#platform-and-node-operator-fee-rates">Platform and Node operator Fee Rates</a></h3>
<p>The platform fee rate value <code>pltbps</code> and node runner fee rate value <code>nodbps</code> will be mutable with by the platform operator, 1 week delay before applicability.</p>
<p>Additionally, the updated fee rate value must be within 500 basis points of the previous one (up to +/- 5% rate change at a time)</p>
<h3 id="changing-scheduled-updates"><a class="header" href="#changing-scheduled-updates">Changing scheduled updates</a></h3>
<p>If an update is issued while a previous update is scheduled, the timer will reset to the initial value of 1 week.</p>
<p>Updates can also be staggered, e.g. the platform fee rate and the node runner fee rate values can be part of the same update. The last update value will reset the timer to 1 week, as before.</p>
<p>The update will be applied automatically after the update timestamp elapses, either explicitly by a platform operator, or when the contract is first called to mint or redeem by any user.</p>
<p>Scheduled updates will be stored as in the <code>next_params_update</code> global storage value.</p>
<p>The structure of this field is:</p>
<pre><code>0: [4 bytes] timestamp_applicable uint32
4: [2 bytes] platform_fee_rate uint16
6: [4 bytes] node_runner_fee_rate uint16
</code></pre>
<h3 id="immediately-updatable-parameters"><a class="header" href="#immediately-updatable-parameters">Immediately updatable parameters</a></h3>
<h4 id="admin-role-account"><a class="header" href="#admin-role-account">Admin role account</a></h4>
<p>The admin address <code>admin</code> will be mutable by the <code>admin</code> role with immediate effect. Changing admin requires two transactions in an atomic group, one from the current admin and one from the future admin. This aims to eliminate the possibility of operator error.</p>
<h3 id="fee-admin-1"><a class="header" href="#fee-admin-1">Fee admin</a></h3>
<p>The fee admin address <code>fee_admin</code> will be mutable by the <code>admin</code> and <code>fee_admin</code> roles with immediate effect.</p>
<h3 id="node-runner-1"><a class="header" href="#node-runner-1">Node runner</a></h3>
<p>The node runner address <code>noderunner</code> will be mutable by the <code>noderunner</code> and <code>fee_admin</code> roles with immediate effect.</p>
<p>Changing the node runner address requires withdrawing node runner fees. This prevents the fee admin role from subverting the node runner fees.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="transaction-fees"><a class="header" href="#transaction-fees">Transaction fees</a></h1>
<p>Users pay for their own transaction fees, e.g. during minting and redeeming.</p>
<p>The smart contract pays for its own inner transaction fees when swapping (0.003 <code>ALGO</code>)</p>
<p>Node runners (or <a href="./roles.html">fee admins</a>) pay for the key registration fees.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="contract-storage--immutable-parameters"><a class="header" href="#contract-storage--immutable-parameters">Contract Storage &amp; Immutable parameters</a></h1>
<p>TBD</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="contract-abi"><a class="header" href="#contract-abi">Contract ABI</a></h1>
<p><a href="./contract.json">Download</a></p>
<pre><code>{
  "name": "dualSTAKE Contract",
  "methods": [
    {
      "name": "register_online",
      "args": [
        {
          "type": "byte[]",
          "name": "selection_key"
        },
        {
          "type": "byte[]",
          "name": "voting_key"
        },
        {
          "type": "byte[]",
          "name": "sp_key"
        },
        {
          "type": "uint64",
          "name": "first_round"
        },
        {
          "type": "uint64",
          "name": "last_round"
        },
        {
          "type": "uint64",
          "name": "key_dilution"
        }
      ],
      "returns": {
        "type": "void"
      },
      "desc": "Fee admin method to send keyreg online for an escrow account"
    },
    {
      "name": "register_offline",
      "args": [
        {
          "type": "address",
          "name": "address"
        }
      ],
      "returns": {
        "type": "void"
      },
      "desc": "Fee admin method to send keyreg offline for an escrow account"
    },
    {
      "name": "init_storage",
      "args": [],
      "returns": {
        "type": "void"
      },
      "desc": "Admin method to init storage. this will be needed as I am reusing an existing app"
    },
    {
      "name": "withdraw_platform_fees",
      "args": [
        {
          "type": "uint64",
          "name": "amt"
        }
      ],
      "returns": {
        "type": "void"
      }
    },
    {
      "name": "mint",
      "args": [],
      "returns": {
        "type": "void"
      },
      "desc": "Public method. Mint dualSTAKE lst\nprevious transaction in group must be payment in ALGO if rate != 0, 2 txns before must be payment in ASA if must_swap, swap send dualSTAKE to caller"
    },
    {
      "name": "burn",
      "args": [],
      "returns": {
        "type": "void"
      }
    },
    {
      "name": "nullun",
      "args": [],
      "returns": {
        "type": "void"
      },
      "desc": "Public empty method for opcode budget increase"
    },
    {
      "name": "create_asset",
      "args": [
        {
          "type": "byte[]",
          "name": "lst_asa_name"
        },
        {
          "type": "byte[]",
          "name": "lst_unit_name"
        }
      ],
      "returns": {
        "type": "void"
      }
    },
    {
      "name": "configure",
      "args": [
        {
          "type": "byte[]",
          "name": "lst_asa_name"
        },
        {
          "type": "byte[]",
          "name": "lst_unit_name"
        },
        {
          "type": "uint64",
          "name": "asa_id"
        },
        {
          "type": "byte[]",
          "name": "lp_type"
        },
        {
          "type": "byte[]",
          "name": "lp_id"
        },
        {
          "type": "uint64",
          "name": "platform_fee_bps"
        },
        {
          "type": "uint64",
          "name": "noderunner_fee_bps"
        },
        {
          "type": "address",
          "name": "admin_addr"
        },
        {
          "type": "address",
          "name": "noderunner_addr"
        }
      ],
      "returns": {
        "type": "void"
      }
    },
    {
      "name": "change_admin_1",
      "args": [
        {
          "type": "address",
          "name": "new_admin"
        }
      ],
      "returns": {
        "type": "void"
      }
    },
    {
      "name": "change_admin_2",
      "args": [],
      "returns": {
        "type": "void"
      }
    },
    {
      "name": "change_noderunner",
      "args": [
        {
          "type": "address",
          "name": "new_noderunner"
        }
      ],
      "returns": {
        "type": "void"
      }
    },
    {
      "name": "change_feeaddr",
      "args": [
        {
          "type": "address",
          "name": "new_feeaddr"
        }
      ],
      "returns": {
        "type": "void"
      }
    }
  ],
  "networks": {}
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="audit"><a class="header" href="#audit">Audit</a></h1>
<p>We intend to obtain an informal audit of the smart contracts by experienced AVM developers.</p>
<p>Furthermore, the dualSTAKE smart contract will be open sourced under a non-permissive license.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="links"><a class="header" href="#links">Links</a></h1>
<p><a href="https://localhost">Protocol frontend: TBD</a></p>
<p><a href="https://dualstake-docs.pages.dev">Documentation</a> ⬅ You are here</p>
<hr />
<p>For contract and token details see <a href="/info.html">Token and Contract Info</a></p>
<p>For contact details see <a href="/contact.html">Contact</a></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="contact"><a class="header" href="#contact">Contact</a></h1>
<p>Email: <code>bit+ds@d13.co</code></p>
<p><code>@d13_co</code> <a href="https://x.com/d13_co">on X</a></p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->

        <script>
        window.addEventListener('load', function() {
            MathJax.Hub.Register.StartupHook('End', function() {
                window.setTimeout(window.print, 100);
            });
        });
        </script>

    </div>
    </body>
</html>
